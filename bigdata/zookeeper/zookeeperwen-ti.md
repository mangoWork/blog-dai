### zookeeper的问题解答



#### 什么是集群脑裂？

&nbsp;　　集群的脑裂通常是发生在节点之间通信不可达的情况下，集群会分裂成不同的小集群，小集群各自选出自己的master节点，导致原有的集群出现多个master节点的情况，这就是脑裂

---------------------

#### 为什么zookeeper有5个节点，至少要3个节点正常？



--------------

#### 为什么Zookeeper一般安装为奇数个节点？

&nbsp;　1. 防止由脑裂造成的集群不可用。

&nbsp;　　在节点数量是奇数个的情况下， zookeeper集群总能对外提供服务（即使损失了一部分节点）；如果节点数量是偶数个，会存在zookeeper集群不能用的可能性（脑裂成两个均等的子集群的时候）。

&nbsp;　2. 容错能力相同的情况下，奇数台更节省资源。

&nbsp;　　leader选举要求的可用节点数量 > 总节点数量/2；其中三个节点只允许一个节点宕机，四个节点也是只允许一个节点宕机；也就是说三个节点和四个节点的容错能力都是相同的，但是三个节点更节省资源。

---------------------



#### Zookeeper节点必须为奇数吗？为什么？

&nbsp;　　答：不一定非得需要奇数，只需要满足可用节点数量 > 总节点数量/2就可以了，但是偶数节点的系统更加的脆弱。假设在集合中使用4个服务器， 那么多数原则对应的数量为3个服务器。 然而， 这个系统仅能容许1个服务器崩溃， 因为两个服务器崩溃就会导致系统失去多数原则的状态。 因此，在4个服务器的情况下， 我们仅能容许一个节点崩溃， 而法定人数现在却更大， 这意味着对每个请求， 我们需要更多的确认操作。

--------------------

#### 当挂掉客户端对应的zookeeper节点，客户端如何去选择其他的节点？

&nbsp;　　会话超时设置了ZooKeeper服务允许会话被声明为超时之前存在的时间。如果经过时间t之后服务接收不到这个会话的任何消息， 服务就会声明会话过期。而在客户端，如果经过t/3的时间未收到任何消息， 客户端将向服务器发送心跳消息。 在经过2t/3时间后， ZooKeeper客户端开始寻找其他的服务器， 而此时它还有t/3时间去寻找其他服务器。

----------------------

#### Zookeeper的锁是如何实现的？

&nbsp;　　为了获得一个锁， 每个进程p尝试创建znode并指定znode为临时节点， 如果进程P成功创建了znode，就表示获得了锁并执行相应代码，其他进程监听创建的znode的变化， 并在检测到/lock删除时再次尝试创建节点来获得锁。

--------------------------

#### Zookeeper的znode的类型


